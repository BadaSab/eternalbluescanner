
exports.negotiate_proto_request = function () {
            return new Buffer([
                0x00,0x00,0x00,0x54,
                0xFF,0x53,0x4D,0x42,0x72,0x00,0x00,0x00,0x00,0x18,
                0x01,0x28,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                0x00,0x00,0x00,0x00,0x00,0x00,0x2F,0x4B,0x00,0x00,
                0xC5,0x5E,0x00,0x31,0x00,0x02,0x4C,0x41,0x4E,0x4D,
                0x41,0x4E,0x31,0x2E,0x30,0x00,0x02,0x4C,0x4D,0x31,
                0x2E,0x32,0x58,0x30,0x30,0x32,0x00,0x02,0x4E,0x54,
                0x20,0x4C,0x41,0x4E,0x4D,0x41,0x4E,0x20,0x31,0x2E,
                0x30,0x00,0x02,0x4E,0x54,0x20,0x4C,0x4D,0x20,0x30,
                0x2E,0x31,0x32,0x00
            ])
};

exports.session_setup_andx_request = function() {
            return new Buffer([
                0x00,0x00,0x00,0x63,
                0xFF,0x53,0x4D,0x42,0x73,0x00,0x00,0x00,0x00,0x18,
                0x01,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                0x00,0x00,0x00,0x00,0x00,0x00,0x2F,0x4B,0x00,0x00,
                0xC5,0x5E,0x0D,0xFF,0x00,0x00,0x00,0xDF,0xFF,0x02,
                0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
                0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x26,
                0x00,0x00,0x2e,0x00,0x57,0x69,0x6e,0x64,0x6f,0x77,
                0x73,0x20,0x32,0x30,0x30,0x30,0x20,0x32,0x31,0x39,
                0x35,0x00,0x57,0x69,0x6e,0x64,0x6f,0x77,0x73,0x20,
                0x32,0x30,0x30,0x30,0x20,0x35,0x2e,0x30,0x00
            ])
}

exports.tree_connect_andx_request = function(ip, userid) {
    var ipc = Buffer.from(utf8_encode("\\\\" + ip + "\\IPC$"),'utf8')
    var data1 = new Buffer([
        0x00,0x00,0x00,0x47,
        0xFF,0x53,0x4D,0x42,0x75,0x00,0x00,0x00,0x00,0x18,
        0x01,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x2F,0x4B])
    var data2 = new Buffer([
        0xC5,0x5E,
        0x04,0xFF,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x1A,
        0x00,0x00
    ])     
    var data3 = new Buffer([
        0x00,0x3f,0x3f,0x3f,0x3f,0x3f,0x00
    ])
    var length=data1.byteLength
    var bufflength=data1.slice(3,3)
    bufflength=length;
    return Buffer.concat([data1,userid,data2,ipc,data3]);
}

exports.peeknamedpipe_request = function(treeid, processid, userid, multiplex_id) {
    var data1 = new Buffer([
      0x00,0x00,0x00,0x4a,
      0xFF,0x53,0x4D,0x42,0x25,0x00,0x00,0x00,0x00,0x18,
      0x01,0x28,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00
    ])
    var data2 = new Buffer([
      0x10,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x4a,0x00,0x00,0x00,0x4a,0x00,0x02,0x00,0x23,
      0x00,0x00,0x00,0x07,0x00,0x5c,0x50,0x49,0x50,0x45,
      0x5c,0x00
    ])
    return Buffer.concat([data1,treeid,processid,userid,multiplex_id,data2]);
}

function utf8_encode(s) {
  return unescape(encodeURIComponent(s));
}